knitr::opts_chunk$set(echo = TRUE, message = FALSE)
library(readr)
library(dplyr, exclude = "lag")
library(yaml)
library(GTrendsStocks)
options <- read_yaml(params$options)
df <- read_rds(
file.path(
"./../large_data", paste_time0(options), "Transform-01-AbnormalReturns.rds"
)
)
# Add column to data containing the number of weeks since Sunday, 1999-12-27
df_2 <- df %>%
mutate(
n_weeks = difftime(date, as.Date("1999-12-27")) %>% as.numeric %/% 7
)
# Weekly average attention
weekly_attention <- df_2 %>%
group_by(n_weeks, ticker) %>%
summarise(
weekly_attention = mean(dly_attention, na.rm = T)
) %>%
mutate(
weekly_attention = if_else(
is.nan(weekly_attention), NA_real_, weekly_attention
)
) %>%
ungroup()
weekly_asvi <- weekly_attention %>%
group_by(ticker) %>%
arrange(n_weeks) %>%
filter(!is.na(weekly_attention)) %>%
mutate(
weekly_asvi = log(weekly_attention) -
log(median_attention(weekly_attention, n_weeks, 7))
)
df_3 <- df_2 %>%
full_join(weekly_asvi, by = c("ticker", "n_weeks"))
dly_asvi <- df_3 %>%
select(date, ticker, dly_attention) %>%
distinct(date, ticker, .keep_all = T) %>%
filter(!is.na(dly_attention)) %>%
group_by(ticker) %>%
arrange(date) %>%
mutate(
dly_asvi =
log(dly_attention) - log(median_attention(dly_attention, as.numeric(date), 42)),
dly_svi_vol = TTR::runSD(dly_attention, n = 21),
dly_asvi_vol = log(dly_svi_vol) - log(median_attention(dly_svi_vol, as.numeric(date), 42))
) %>%
select(date, ticker, dly_asvi, dly_svi_vol, dly_asvi_vol)
df_4 <- df_3 %>%
left_join(dly_asvi, by = c("ticker", "date"))
write_rds(
df_4,
file.path(
"./../large_data",
paste_time0(options),
"Transform-02-AbnormalAttention.rds"
)
)
knitr::opts_chunk$set(echo = TRUE)
library(GTrendsStocks)
library(yaml)
library(readr)
library(lubridate)
options <- read_yaml(params$options)
df <- read_rds(
file.path(
"./../large_data", paste_time0(options), "Transform-02-AbnormalAttention.rds"
)
)
turnover <- df %>%
filter(!is.na(volume), volume > 0) %>%
select(date, ticker, turnover = volume) %>%
arrange(date) %>%
mutate(
month = month(date)
) %>%
group_by(ticker) %>%
mutate(
t = match(date, unique(date)),
abn_turnover = detrend_chordia_2007(turnover, month, t),
log_abn_turnover = detrend_chordia_2007(log(turnover), month, t)
) %>%
select(date, ticker, abn_turnover, log_abn_turnover)
df_2 <- full_join(df, turnover, by = c("date", "ticker"))
write_rds(
df_2,
file.path(
"./../large_data", paste_time0(options), "Transform-03-AbnormalTurnover.rds"
)
)
knitr::opts_chunk$set(echo = TRUE)
library(GTrendsStocks)
library(yaml)
library(readr)
library(lubridate)
options <- read_yaml(params$options)
df <- read_rds(
file.path(
"./../large_data", paste_time0(options), "Transform-02-AbnormalAttention.rds"
)
)
turnover <- df %>%
filter(!is.na(volume), volume > 0) %>%
select(date, ticker, turnover = volume) %>%
arrange(date) %>%
mutate(
month = month(date)
) %>%
group_by(ticker) %>%
mutate(
t = match(date, unique(date)),
abn_turnover = detrend_chordia_2007(turnover, month, t),
log_abn_turnover = detrend_chordia_2007(log(turnover), month, t)
) %>%
select(date, ticker, abn_turnover, log_abn_turnover)
df_2 <- full_join(df, turnover, by = c("date", "ticker"))
write_rds(
df_2,
file.path(
"./../large_data", paste_time0(options), "Transform-03-AbnormalTurnover.rds"
)
)
gc()
library(yaml)
library(GTrendsStocks)
library(readr)
options <- read_yaml(params$options)
df <- read_rds(file.path("./../large_data", paste_time0(options), "Transform-03-AbnormalTurnover.rds"))
nrow(filter(df, !is.na(dly_attention), dly_attention == 0)) / nrow(df %>% filter(!is.na(dly_attention)))
df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention[dly_attention == 0]) / n())
df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention[dly_attention == 0]) / n()) -> x
hist(x)
hist(x$ratio)
df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention == 0) / n()) -> x
x
hist(x)
hist(x$ratio)
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention == 0) / n())
hist(zero_obs_ratio$ratio)
?title
title(main = "X")
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention == 0) / n())
hist(zero_obs_ratio$ratio)
title(main = "", xlab = "Percentage of zero-attention observations", ylab = "Frequency")
hist(zero_obs_ratio$ratio)
title(main = "", xlab = "Percentage of zero-attention observations", ylab = "Frequency")
?title
plot(cars, main = "") # here, could use main directly
title(main = "Stopping Distance versus Speed")
?geom_histogram
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention == 0) / n())
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations")
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations") +
geom_histogram()
?geom_histogram
library(ggplot2)
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations") +
geom_histogram(bins = 5)
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations") +
geom_histogram(bins = 10) +
theme_bw()
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention == 0) / n())
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations", y = "Frequency") +
geom_histogram(bins = 10) +
theme_bw()
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention), !is.na(ret)) %>% summarise(ratio = sum(dly_attention == 0) / n())
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations", y = "Frequency") +
geom_histogram(bins = 10) +
theme_bw()
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention), !is.na(ret)) %>% summarise(ratio = sum(dly_attention == 0) / n())
zero_obs_ratio
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention == 0) / n())
zero_obs_ratio
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention == 0) / n())
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations", y = "Frequency") +
geom_histogram(bins = 10) +
theme_bw()
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention), !is.na(ret)) %>% summarise(ratio = sum(dly_attention == 0) / n())
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations", y = "Frequency") +
geom_histogram(bins = 10) +
theme_bw()
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention)) %>% summarise(ratio = sum(dly_attention == 0) / n())
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations", y = "Frequency", title = "All days") +
geom_histogram(bins = 10) +
theme_bw()
zero_obs_ratio <- df %>% group_by(ticker) %>% filter(!is.na(dly_attention), !is.na(ret)) %>% summarise(ratio = sum(dly_attention == 0) / n())
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations", y = "Frequency", title = "Trading-days") +
geom_histogram(bins = 10) +
theme_bw()
knitr::opts_chunk$set(echo = TRUE, include = FALSE)
yss <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
mutate(summary(dly_attention))
yss <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
mutate(as.data.frame(summary(dly_attention)))
summary(df$dly_attention)
summary(df$dly_attention) %>% as.data.frame()
summary(df$dly_attention) %>% as_tibble()
summary(df$dly_attention) -> x
str(x)
as.list(x)
yss <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
mutate(dly_attention %>% summary %>% as.list %>% as.data.frame)
yss
yss <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
summarise(dly_attention %>% summary %>% as.list %>% as.data.frame)
yss
zero_obs_ratio
zero_obs_ratio <- df %>%
group_by(ticker) %>%
filter(!is.na(dly_attention)) %>%
summarise(
ratio = sum(dly_attention == 0) / n(),
market_cap = mean(market_cap)
)
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations", y = "Frequency", title = "All days") +
geom_histogram(bins = 10) +
theme_bw()
zero_obs_ratio <- df %>%
group_by(ticker) %>%
filter(!is.na(dly_attention), !is.na(ret)) %>%
summarise(
ratio = sum(dly_attention == 0) / n(),
market_cap = mean(market_cap)
)
ggplot(zero_obs_ratio, aes(x = ratio)) +
labs(x = "Percentage of zero-attention observations", y = "Frequency", title = "Trading-days") +
geom_histogram(bins = 10) +
theme_bw()
mean(zero_obs_ratio$ratio)
weighted.mean(zero_obs_ratio$ratio, zero_obs_ratio$market_cap)
yss <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
summarise(dly_attention %>% summary %>% as.list %>% as.data.frame)
yss_all <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
summarise(dly_attention %>% summary %>% as.list %>% as.data.frame)
yss_all
yss_td <- df %>%
filter(!is.na(dly_attention), !is.na(ret)) %>%
group_by(period) %>%
summarise(dly_attention %>% summary %>% as.list %>% as.data.frame)
yss_td
yss_all_nz <- df %>%
filter(!is.na(dly_attention), dly_attention != 0) %>%
group_by(period) %>%
summarise(dly_attention %>% summary %>% as.list %>% as.data.frame)
yss_all_nz
yss_td_nz <- df %>%
filter(!is.na(dly_attention), !is.na(ret), dly_attention != 0) %>%
group_by(period) %>%
summarise(dly_attention %>% summary %>% as.list %>% as.data.frame)
yss_td_nz
yss_all_nz
yss_all
yss_all <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
summarise(
dly_attention %>%
summary %>%
as.list %>%
as_tibble %>%
select(X1st.Qu., Median, Mean, X3rd.Qu.)
)
names(yss_td)
yss_all <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
summarise(
dly_attention %>%
summary %>%
as.list %>%
as_tibble %>%
print %>%
select(X1st.Qu., Median, Mean, X3rd.Qu.)
)
yss_all <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
summarise(
dly_attention %>%
summary %>%
as.list %>%
as_tibble %>%
print %>%
select(`1st Qu.`, Median, Mean, `3rd Qu.`)
)
yss_all
yss_all <- df %>%
filter(!is.na(dly_attention)) %>%
group_by(period) %>%
summarise(
dly_attention %>%
summary %>%
as.list %>%
as_tibble %>%
select(`1st Qu.`, Median, Mean, `3rd Qu.`)
)
yss_all
yss_td <- df %>%
filter(!is.na(dly_attention), !is.na(ret)) %>%
group_by(period) %>%
summarise(
dly_attention %>%
summary %>%
as.list %>%
as_tibble %>%
select(`1st Qu.`, Median, Mean, `3rd Qu.`)
)
yss_td
yss_all_nz <- df %>%
filter(!is.na(dly_attention), dly_attention != 0) %>%
group_by(period) %>%
summarise(
dly_attention %>%
summary %>%
as.list %>%
as_tibble %>%
select(`1st Qu.`, Median, Mean, `3rd Qu.`)
)
yss_all_nz
yss_td_nz <- df %>%
filter(!is.na(dly_attention), !is.na(ret), dly_attention != 0) %>%
group_by(period) %>%
summarise(
dly_attention %>%
summary %>%
as.list %>%
as_tibble %>%
select(`1st Qu.`, Median, Mean, `3rd Qu.`)
)
yss_td_nz
knitr::opts_chunk$set(echo = TRUE)
library(GTrendsStocks)
library(readr)
library(zoo)
library(plm)
library(lmtest)
library(yaml)
options <- read_yaml(params$options)
df <- read_rds(
file.path(
"./../large_data", paste_time0(options), "Transform-03-AbnormalTurnover.rds"
)
)
weekly_df <- df %>%
group_by(n_weeks, ticker) %>%
summarise(
weekly_asvi = weekly_asvi[1],
size = size[1],
weekly_abn_ret = weekly_abn_ret[1],
weekly_abn_turnover = sum(abn_turnover, na.rm = T)
) %>%
distinct(n_weeks, ticker, weekly_asvi, size, weekly_abn_ret, weekly_abn_turnover) %>%
filter(!is.na(weekly_asvi)) %>%
mutate(intercept = 1) %>%
mutate(
weekly_abn_turnover = weekly_abn_turnover / sd(weekly_abn_turnover),
weekly_abn_ret = weekly_abn_ret / sd(weekly_abn_ret),
size = size / sd(size)
)
weekly_mod <- plm(
weekly_asvi ~ intercept + log(size) + abs(weekly_abn_ret) + weekly_abn_turnover,
data = weekly_df,
index = c("ticker", "n_weeks"),
effect = "time",
model = "pooling"
)
weekly_df
weekly_df <- df %>%
group_by(n_weeks, ticker) %>%
summarise(
weekly_asvi = weekly_asvi[1],
size = size[1],
weekly_abn_ret = weekly_abn_ret[1],
weekly_abn_turnover = sum(abn_turnover, na.rm = T)
) %>%
distinct(n_weeks, ticker, weekly_asvi, size, weekly_abn_ret, weekly_abn_turnover) %>%
filter(!is.na(weekly_asvi), is.finite(weekly_asvi)) %>%
mutate(intercept = 1) %>%
mutate(
weekly_abn_turnover = weekly_abn_turnover / sd(weekly_abn_turnover),
weekly_abn_ret = weekly_abn_ret / sd(weekly_abn_ret),
size = size / sd(size)
)
weekly_mod <- plm(
weekly_asvi ~ intercept + log(size) + abs(weekly_abn_ret) + weekly_abn_turnover,
data = weekly_df,
index = c("ticker", "n_weeks"),
effect = "time",
model = "pooling"
)
summary(weekly_mod)
library(GTrendsStocks)
library(readr)
library(zoo)
library(plm)
library(lmtest)
library(yaml)
options <- read_yaml(params$options)
df <- read_rds(
file.path(
"./../large_data", paste_time0(options), "Transform-03-AbnormalTurnover.rds"
)
)
weekly_df <- df %>%
group_by(n_weeks, ticker) %>%
summarise(
weekly_asvi = weekly_asvi[1],
size = size[1],
weekly_abn_ret = weekly_abn_ret[1],
weekly_abn_turnover = sum(abn_turnover, na.rm = T)
) %>%
distinct(n_weeks, ticker, weekly_asvi, size, weekly_abn_ret, weekly_abn_turnover) %>%
filter(!is.na(weekly_asvi), is.finite(weekly_asvi)) %>%
mutate(intercept = 1) %>%
mutate(
weekly_abn_turnover = weekly_abn_turnover / sd(weekly_abn_turnover),
weekly_abn_ret = weekly_abn_ret / sd(weekly_abn_ret),
size = size / sd(size)
)
weekly_mod <- plm(
weekly_asvi ~ intercept + log(size) + abs(weekly_abn_ret) + weekly_abn_turnover,
data = weekly_df,
index = c("ticker", "n_weeks"),
effect = "time",
model = "pooling"
)
summary(weekly_mod)
weekly_df <- df %>%
group_by(n_weeks, ticker) %>%
summarise(
weekly_asvi = weekly_asvi[1],
size = size[1],
weekly_abn_ret = weekly_abn_ret[1],
weekly_abn_turnover = sum(abn_turnover, na.rm = T)
) %>%
distinct(n_weeks, ticker, weekly_asvi, size, weekly_abn_ret, weekly_abn_turnover) %>%
filter(!is.na(weekly_asvi), is.finite(weekly_asvi), weekly_attention > 0) %>%
mutate(intercept = 1) %>%
mutate(
weekly_abn_turnover = weekly_abn_turnover / sd(weekly_abn_turnover),
weekly_abn_ret = weekly_abn_ret / sd(weekly_abn_ret),
size = size / sd(size)
)
weekly_attention
weekly_df <- df %>%
group_by(n_weeks, ticker) %>%
summarise(
weekly_asvi = weekly_asvi[1],
size = size[1],
weekly_abn_ret = weekly_abn_ret[1],
weekly_abn_turnover = sum(abn_turnover, na.rm = T)
) %>%
distinct(n_weeks, ticker, .keep_all = T) %>%
filter(!is.na(weekly_asvi), is.finite(weekly_asvi), weekly_attention > 0) %>%
mutate(intercept = 1) %>%
mutate(
weekly_abn_turnover = weekly_abn_turnover / sd(weekly_abn_turnover),
weekly_abn_ret = weekly_abn_ret / sd(weekly_abn_ret),
size = size / sd(size)
)
names(df)
weekly_df <- df %>%
group_by(n_weeks, ticker) %>%
filter(weekly_attention > 0) %>%
summarise(
weekly_asvi = weekly_asvi[1],
size = size[1],
weekly_abn_ret = weekly_abn_ret[1],
weekly_abn_turnover = sum(abn_turnover, na.rm = T)
) %>%
distinct(n_weeks, ticker, .keep_all = T) %>%
filter(!is.na(weekly_asvi), is.finite(weekly_asvi)) %>%
mutate(intercept = 1) %>%
mutate(
weekly_abn_turnover = weekly_abn_turnover / sd(weekly_abn_turnover),
weekly_abn_ret = weekly_abn_ret / sd(weekly_abn_ret),
size = size / sd(size)
)
weekly_mod <- plm(
weekly_asvi ~ intercept + log(size) + abs(weekly_abn_ret) + weekly_abn_turnover,
data = weekly_df,
index = c("ticker", "n_weeks"),
effect = "time",
model = "pooling"
)
summary(weekly_mod)
